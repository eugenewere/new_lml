{% extends 'normal/layout/homelayout.html' %}
{% load static %}
{% load call_methods %}
{% load humanize %}
{% block links %}

{% endblock links %}
{% block content %}
			
        <!-- Title Header Start -->
        <section  class="inner-header-title" style="background-image:url({% static 'assets/img/blog/banner-19.jpg' %});">
            <div class="container">
                <h3 class="text-capitalize" style="color: white;">The {{pricing.title}} Package</h3>
            </div>
        </section>
        <div class="clearfix"></div>
        <!-- Title Header End -->
        <section class="accordion">
            <div class="container">
                <div  class="deatil-tab-employ tool-tab col-sm-12 col-md-12 col-lg-10 " id="geid" data-dd="{{ pricing.id }}" style="background: white; width: 100%;" >
                    <ul class="nav simple nav-tabs" id="simple-design-tab1" style="display: flex; justify-content: center; flex-wrap: wrap;">
                        <li class="active"><a data-toggle="pill" href="#all2">Mpesa</a></li>
                        <li class=""><a data-toggle="pill" href="#basic22">PayPal</a></li>
                    </ul>

                    <!-- Start All Sec -->
                    <div id="tabcont"  class="tab-content" style="height: 800px;overflow-x: hidden; overflow-y: scroll;">
                        <div id="all2" class="tab-pane fade-in active" style="height: 100%;">
                            <div class="col-sm-12" style="padding: 0;">
                                 <form enctype="application/x-www-form-urlencoded" action="{% url 'LML:mpesa_send_stk_push_callback' %}" method="post"  class="billing-form">
                                        <div class="row">
                                            <!-- Payment Detail -->
                                            <div class="col-md-12 col-lg-6 col-sm-12">
                                                <div class="sidebar-wrapper">

                                                    <div class="sidebar-box-header bb-1">
                                                        <h4>Account Number</h4>
                                                    </div>


{#                                                    <div class="row">#}
{#                                                        <div class="pr-header active" style="display: flex; flex-direction: column; justify-content: center;align-items: center; margin-bottom: 15px;">#}
{#                                                            <div class="pr-plan">#}
{#                                                                <h4>Use This As Paybill Number:</h4>#}
{#                                                            </div>#}
{#                                                            <div class="pr-price">#}
{#                                                                <h3 style="font-size: 3.4em;"><sup>Paybill Number.</sup>443323</h3>#}
{#                                                            </div>#}
{#                                                        </div>#}
{#                                                    </div>#}
                                                    <div class="row">
                                                        <div class="pr-header h-100 " style="display: flex; flex-direction: column; justify-content: center;align-items: center; margin-bottom: 15px;">
                                                            <div class="pr-plan">
                                                                <h4>Package Plan Amount For <strong> {{ pricing.title|title }}</strong></h4>
                                                            </div>
                                                            <div class="pr-price">
                                                                <h3><sup>ksh.</sup>{{pricing.price|intcomma }} <sub>/{{ pricing.status }}</sub></h3>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <!-- Billing Address -->
                                            <div class="col-md-12 col-lg-6 col-sm-12">
                                                <div class="sidebar-wrapper">

                                                <div class="sidebar-box-header bb-1">
                                                    <h4>Payment Information</h4>
                                                </div>


                                                    <div style="width: 100%; height: 205px;">
                                                        <img style="width: 100%; height: 100%; object-fit: contain;" src="{% static 'assets/img/MPESA-Logo.png' %}" alt="">
                                                    </div>
                                                    <div class="row">
                                                        {% csrf_token %}
                                                        <div class="col-xs-12">
                                                            <label>Mpesa Prefered Phone</label>
                                                            <input type="text" name="phone" class="form-control" placeholder="07xxxxxxxx" />
                                                        </div>
                                                        <input style="display: none" name="amount" value="{{ pricing.price }}" type="text" class="form-control" placeholder="07xxxxxxxx" />
                                                    </div>



                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12 text-center">
                                                <button type="submit"  class="btn btn-primary custom-button">Proceed...</button>
                                                <a href="#" onclick="goback();" class="btn btn-default custom-button">Cancel...</a>
                                            </div>
                                        </div>
                                 </form>
                            </div>
                        </div>
                        <div id="basic22" class="tab-pane fade-in payp" style="height: 100%;">
                            <h2 class="detail-title  mb-5">Pay with PayPal</h2>
                            <div class="container-fluid" style="">
                               <div class="col-sm-12 col-md-12 col-lg-6" style="height: 100%;">
                                    <div class="row" style=" padding: 20px;">
                                        <div class="pr-header  prh " style="display: flex; flex-direction: column; justify-content: center;align-items: center; margin-bottom: 15px;">
                                            <div class="pr-plan">
                                                <h4>Registration Amount In Kshs</h4>
                                            </div>
                                            <div class="pr-price">
                                                <h3><sup>KSH.</sup>{{ pricing.price|intcomma }}</h3>
                                            </div>
                                            <div class="pr-plan" style="margin-top: 10px;">
                                                <h4>Registration Amount In USD</h4>
                                            </div>
                                            <div class="pr-price">
                                                <h3><sup>USD.</sup>{{ pricing.price|to_usd|intcomma}}</h3>
                                            </div>
                                        </div>
                                    </div>
                               </div>
                               <div class="col-sm-12 col-md-12 col-lg-6" style="height: 100%;">
                                    <div class="row" style="display: flex; justify-content: center; align-items: center ; padding: 20px;">
                                        <div id="paypal-button-container" style="display: flex; flex-direction: column; justify-content: flex-start; align-items: center;width: 100%; "></div>
                                    </div>
                               </div>
                            </div>
                        </div>
                    </div>
                      <!-- End Settings -->
               </div>
            </div>
        </section>
        <!-- Accordion Design Start -->
        <!-- Accordion Design End -->
{% endblock content %}
{% block script %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="{% static 'assets/js/js.js' %}" type="text/javascript"></script>
     <script src="https://www.paypal.com/sdk/js?client-id=AYvT3OhFdk32s6G9Af6j-7YAOzrOcTLJ1e1l5FvIn_CapqQQyzSksAJaYM1nxRBBeMPEdfzI-xz1xxFy"></script>
    <script src="{% static 'assets/jspayload/jspaysubscribe.js' %}"></script>

    <script>
        $(document).ready(function () {


            $('.billing-form').submit(function (e) {
                e.preventDefault();
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                const csrftoken = getCookie('csrftoken');
                var form = $(this);
                var url = $(this).attr('action');
                let form_data = $(this).serialize();

                $.ajax({

                    type: 'POST',
                    url: url,
                    data: JSON.stringify(form_data),
                    headers: {
                        'Content-type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': csrftoken,
                    },
                    {#contentType: "application/x-www-form-urlencoded",#}
                    dataType: 'json',
                    success: function(data){
                        console.log(data);
                    },
                    error: function(error){
                        console.log(error);
                    },

                 });

            });
         });
    </script>


{% endblock script %}
			

